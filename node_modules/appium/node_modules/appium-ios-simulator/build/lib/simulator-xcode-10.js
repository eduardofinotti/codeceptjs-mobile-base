'use strict';

var _get = require('babel-runtime/helpers/get')['default'];

var _inherits = require('babel-runtime/helpers/inherits')['default'];

var _createClass = require('babel-runtime/helpers/create-class')['default'];

var _classCallCheck = require('babel-runtime/helpers/class-call-check')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _simulatorXcode93 = require('./simulator-xcode-9.3');

var _simulatorXcode932 = _interopRequireDefault(_simulatorXcode93);

var _nodeSimctl = require('node-simctl');

var _appiumSupport = require('appium-support');

var SimulatorXcode10 = (function (_SimulatorXcode93) {
  _inherits(SimulatorXcode10, _SimulatorXcode93);

  function SimulatorXcode10(udid, xcodeVersion) {
    _classCallCheck(this, SimulatorXcode10);

    _get(Object.getPrototypeOf(SimulatorXcode10.prototype), 'constructor', this).call(this, udid, xcodeVersion);
  }

  /**
   * Verify whether the particular application is installed on Simulator.
   * @override
   *
   * @param {string} bundleId - The bundle id of the application to be checked.
   * @return {boolean} True if the given application is installed.
   */

  _createClass(SimulatorXcode10, [{
    key: 'isAppInstalled',
    value: function isAppInstalled(bundleId) {
      var appContainer, info;
      return _regeneratorRuntime.async(function isAppInstalled$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
            context$2$0.prev = 0;
            context$2$0.next = 3;
            return _regeneratorRuntime.awrap((0, _nodeSimctl.getAppContainer)(this.udid, bundleId, false));

          case 3:
            appContainer = context$2$0.sent;

            if (appContainer.endsWith('.app')) {
              context$2$0.next = 6;
              break;
            }

            return context$2$0.abrupt('return', false);

          case 6:
            context$2$0.next = 8;
            return _regeneratorRuntime.awrap(_appiumSupport.fs.exists(appContainer));

          case 8:
            return context$2$0.abrupt('return', context$2$0.sent);

          case 11:
            context$2$0.prev = 11;
            context$2$0.t0 = context$2$0['catch'](0);
            context$2$0.prev = 13;
            context$2$0.next = 16;
            return _regeneratorRuntime.awrap((0, _nodeSimctl.appInfo)(this.udid, bundleId));

          case 16:
            info = context$2$0.sent;
            return context$2$0.abrupt('return', info.includes('ApplicationType'));

          case 20:
            context$2$0.prev = 20;
            context$2$0.t1 = context$2$0['catch'](13);

          case 22:
            return context$2$0.abrupt('return', false);

          case 23:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this, [[0, 11], [13, 20]]);
    }
  }]);

  return SimulatorXcode10;
})(_simulatorXcode932['default']);

exports['default'] = SimulatorXcode10;
module.exports = exports['default'];

// get_app_container subcommand fails for system applications,
// so we try the hidden appinfo subcommand, which prints correct info for
// system/hidden apps
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zaW11bGF0b3IteGNvZGUtMTAuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O2dDQUE2Qix1QkFBdUI7Ozs7MEJBQ1gsYUFBYTs7NkJBQ25DLGdCQUFnQjs7SUFHN0IsZ0JBQWdCO1lBQWhCLGdCQUFnQjs7QUFDUixXQURSLGdCQUFnQixDQUNQLElBQUksRUFBRSxZQUFZLEVBQUU7MEJBRDdCLGdCQUFnQjs7QUFFbEIsK0JBRkUsZ0JBQWdCLDZDQUVaLElBQUksRUFBRSxZQUFZLEVBQUU7R0FDM0I7Ozs7Ozs7Ozs7ZUFIRyxnQkFBZ0I7O1dBWUMsd0JBQUMsUUFBUTtVQUVwQixZQUFZLEVBVVYsSUFBSTs7Ozs7OzZDQVZlLGlDQUFnQixJQUFJLENBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxLQUFLLENBQUM7OztBQUFoRSx3QkFBWTs7Z0JBQ2IsWUFBWSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7Ozs7O2dEQUN6QixLQUFLOzs7OzZDQUVELGtCQUFHLE1BQU0sQ0FBQyxZQUFZLENBQUM7Ozs7Ozs7Ozs7NkNBTWYseUJBQVEsSUFBSSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUM7OztBQUF6QyxnQkFBSTtnREFDSCxJQUFJLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDOzs7Ozs7O2dEQUdwQyxLQUFLOzs7Ozs7O0tBQ2I7OztTQTdCRyxnQkFBZ0I7OztxQkFnQ1AsZ0JBQWdCIiwiZmlsZSI6ImxpYi9zaW11bGF0b3IteGNvZGUtMTAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgU2ltdWxhdG9yWGNvZGU5MyBmcm9tICcuL3NpbXVsYXRvci14Y29kZS05LjMnO1xuaW1wb3J0IHsgZ2V0QXBwQ29udGFpbmVyLCBhcHBJbmZvIH0gZnJvbSAnbm9kZS1zaW1jdGwnO1xuaW1wb3J0IHsgZnMgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5cblxuY2xhc3MgU2ltdWxhdG9yWGNvZGUxMCBleHRlbmRzIFNpbXVsYXRvclhjb2RlOTMge1xuICBjb25zdHJ1Y3RvciAodWRpZCwgeGNvZGVWZXJzaW9uKSB7XG4gICAgc3VwZXIodWRpZCwgeGNvZGVWZXJzaW9uKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWZXJpZnkgd2hldGhlciB0aGUgcGFydGljdWxhciBhcHBsaWNhdGlvbiBpcyBpbnN0YWxsZWQgb24gU2ltdWxhdG9yLlxuICAgKiBAb3ZlcnJpZGVcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gVGhlIGJ1bmRsZSBpZCBvZiB0aGUgYXBwbGljYXRpb24gdG8gYmUgY2hlY2tlZC5cbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgZ2l2ZW4gYXBwbGljYXRpb24gaXMgaW5zdGFsbGVkLlxuICAgKi9cbiAgYXN5bmMgaXNBcHBJbnN0YWxsZWQgKGJ1bmRsZUlkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGFwcENvbnRhaW5lciA9IGF3YWl0IGdldEFwcENvbnRhaW5lcih0aGlzLnVkaWQsIGJ1bmRsZUlkLCBmYWxzZSk7XG4gICAgICBpZiAoIWFwcENvbnRhaW5lci5lbmRzV2l0aCgnLmFwcCcpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhd2FpdCBmcy5leGlzdHMoYXBwQ29udGFpbmVyKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIC8vIGdldF9hcHBfY29udGFpbmVyIHN1YmNvbW1hbmQgZmFpbHMgZm9yIHN5c3RlbSBhcHBsaWNhdGlvbnMsXG4gICAgICAvLyBzbyB3ZSB0cnkgdGhlIGhpZGRlbiBhcHBpbmZvIHN1YmNvbW1hbmQsIHdoaWNoIHByaW50cyBjb3JyZWN0IGluZm8gZm9yXG4gICAgICAvLyBzeXN0ZW0vaGlkZGVuIGFwcHNcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGluZm8gPSBhd2FpdCBhcHBJbmZvKHRoaXMudWRpZCwgYnVuZGxlSWQpO1xuICAgICAgICByZXR1cm4gaW5mby5pbmNsdWRlcygnQXBwbGljYXRpb25UeXBlJyk7XG4gICAgICB9IGNhdGNoIChpZ24pIHt9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTaW11bGF0b3JYY29kZTEwO1xuIl0sInNvdXJjZVJvb3QiOiIuLi8uLiJ9
