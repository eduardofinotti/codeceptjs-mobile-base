'use strict';

var _get = require('babel-runtime/helpers/get')['default'];

var _inherits = require('babel-runtime/helpers/inherits')['default'];

var _createClass = require('babel-runtime/helpers/create-class')['default'];

var _classCallCheck = require('babel-runtime/helpers/class-call-check')['default'];

var _toConsumableArray = require('babel-runtime/helpers/to-consumable-array')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _ = require('../../..');

var _libBasedriverCommandsFind = require('../../../lib/basedriver/commands/find');

var _appiumSupport = require('appium-support');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var TestDriver = (function (_BaseDriver) {
  _inherits(TestDriver, _BaseDriver);

  function TestDriver() {
    _classCallCheck(this, TestDriver);

    _get(Object.getPrototypeOf(TestDriver.prototype), 'constructor', this).apply(this, arguments);
  }

  _createClass(TestDriver, [{
    key: 'getWindowSize',
    value: function getWindowSize() {
      return _regeneratorRuntime.async(function getWindowSize$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }, {
    key: 'getScreenshot',
    value: function getScreenshot() {
      return _regeneratorRuntime.async(function getScreenshot$(context$2$0) {
        while (1) switch (context$2$0.prev = context$2$0.next) {
          case 0:
          case 'end':
            return context$2$0.stop();
        }
      }, null, this);
    }
  }]);

  return TestDriver;
})(_.BaseDriver);

var TINY_PNG = "iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAIAAAAmkwkpAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQwIDc5LjE2MDQ1MSwgMjAxNy8wNS8wNi0wMTowODoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6N0NDMDM4MDM4N0U2MTFFOEEzMzhGMTRFNUUwNzIwNUIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6N0NDMDM4MDQ4N0U2MTFFOEEzMzhGMTRFNUUwNzIwNUIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3Q0MwMzgwMTg3RTYxMUU4QTMzOEYxNEU1RTA3MjA1QiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3Q0MwMzgwMjg3RTYxMUU4QTMzOEYxNEU1RTA3MjA1QiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpdvJjQAAAAlSURBVHjaJInBEQAACIKw/Xe2Ul5wYBtwmJqkk4+zfvUQVoABAEg0EfrZwc0hAAAAAElFTkSuQmCC";
var TINY_PNG_DIMS = [4, 4];

describe('finding elements by image', function () {
  describe('findElement', function () {
    it('should use a different special method to find element by image', function callee$2$0() {
      var d;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();

            _sinon2['default'].stub(d, 'findByImage').returns(true);
            _sinon2['default'].stub(d, 'findElOrElsWithProcessing').returns(false);
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(d.findElement(_libBasedriverCommandsFind.IMAGE_STRATEGY, 'foo').should.eventually.be['true']);

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(d.findElements(_libBasedriverCommandsFind.IMAGE_STRATEGY, 'foo').should.eventually.be['true']);

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should not be able to find image element from any other element', function callee$2$0() {
      var d;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(d.findElementFromElement(_libBasedriverCommandsFind.IMAGE_STRATEGY, 'foo', 'elId').should.eventually.be.rejectedWith(/Locator Strategy.+is not supported/));

          case 3:
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(d.findElementsFromElement(_libBasedriverCommandsFind.IMAGE_STRATEGY, 'foo', 'elId').should.eventually.be.rejectedWith(/Locator Strategy.+is not supported/));

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  describe('findByImage', function () {
    var rect = { x: 10, y: 20, width: 30, height: 40 };
    var size = { width: 100, height: 200 };
    var screenshot = 'iVBORfoo';
    var template = 'iVBORbar';

    function basicStub(driver) {
      var sizeStub = _sinon2['default'].stub(driver, 'getWindowSize').returns(size);
      var screenStub = _sinon2['default'].stub(driver, 'getScreenshotForImageFind').returns(screenshot);
      var compareStub = _sinon2['default'].stub(driver, 'compareImages').returns({ rect: rect });
      return { sizeStub: sizeStub, screenStub: screenStub, compareStub: compareStub };
    }

    function basicImgElVerify(imgElProto, driver) {
      var imgElId = imgElProto.ELEMENT;
      driver._imgElCache.has(imgElId).should.be['true'];
      var imgEl = driver._imgElCache.get(imgElId);
      (imgEl instanceof _.ImageElement).should.be['true'];
      imgEl.rect.should.eql(rect);
      return imgEl;
    }

    it('should find an image element happypath', function callee$2$0() {
      var d, imgElProto;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();

            basicStub(d);
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(d.findByImage(template, { multiple: false }));

          case 4:
            imgElProto = context$3$0.sent;

            basicImgElVerify(imgElProto, d);

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should find image elements happypath', function callee$2$0() {
      var d, els;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();

            basicStub(d);
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(d.findByImage(template, { multiple: true }));

          case 4:
            els = context$3$0.sent;

            els.should.have.length(1);
            basicImgElVerify(els[0], d);

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should fail if driver does not support getWindowSize', function callee$2$0() {
      var d;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new _.BaseDriver();
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(d.findByImage(template, { multiple: false }).should.eventually.be.rejectedWith(/driver does not support/));

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should fix template size if requested', function callee$2$0() {
      var d, newTemplate, _basicStub, compareStub, imgElProto, imgEl;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();
            newTemplate = 'iVBORbaz';
            _basicStub = basicStub(d);
            compareStub = _basicStub.compareStub;
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(d.settings.update({ fixImageTemplateSize: true }));

          case 6:
            _sinon2['default'].stub(d, 'ensureTemplateSize').returns(newTemplate);
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(d.findByImage(template, { multiple: false }));

          case 9:
            imgElProto = context$3$0.sent;
            imgEl = basicImgElVerify(imgElProto, d);

            imgEl.template.should.eql(newTemplate);
            compareStub.args[0][2].should.eql(newTemplate);

          case 13:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should throw an error if template match fails', function callee$2$0() {
      var d, _basicStub2, compareStub;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();
            _basicStub2 = basicStub(d);
            compareStub = _basicStub2.compareStub;

            compareStub.throws(new Error('Cannot find any occurrences'));
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(d.findByImage(template, { multiple: false }).should.eventually.be.rejectedWith(/element could not be located/));

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should return empty array for multiple elements if template match fails', function callee$2$0() {
      var d, _basicStub3, compareStub;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();
            _basicStub3 = basicStub(d);
            compareStub = _basicStub3.compareStub;

            compareStub.throws(new Error('Cannot find any occurrences'));
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(d.findByImage(template, { multiple: true }).should.eventually.eql([]));

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should respect implicit wait', function callee$2$0() {
      var d, _basicStub4, compareStub, imgElProto;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();

            d.setImplicitWait(10);
            _basicStub4 = basicStub(d);
            compareStub = _basicStub4.compareStub;

            compareStub.onCall(0).throws(new Error('Cannot find any occurrences'));
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(d.findByImage(template, { multiple: false }));

          case 7:
            imgElProto = context$3$0.sent;

            basicImgElVerify(imgElProto, d);
            compareStub.callCount.should.eql(2);

          case 10:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should not add element to cache and return it directly when checking staleness', function callee$2$0() {
      var d, imgEl;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();

            basicStub(d);
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(d.findByImage(template, { multiple: false, shouldCheckStaleness: true }));

          case 4:
            imgEl = context$3$0.sent;

            (imgEl instanceof _.ImageElement).should.be['true'];
            d._imgElCache.has(imgEl.id).should.be['false'];
            imgEl.rect.should.eql(rect);

          case 8:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  describe('ensureTemplateSize', function () {
    it('should not resize the template if it is smaller than the screen', function callee$2$0() {
      var screen, d;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            screen = TINY_PNG_DIMS.map(function (n) {
              return n * 2;
            });
            d = new TestDriver();
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(d.ensureTemplateSize.apply(d, [TINY_PNG].concat(_toConsumableArray(screen))).should.eventually.eql(TINY_PNG));

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should not resize the template if it is the same size as the screen', function callee$2$0() {
      var d;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(d.ensureTemplateSize.apply(d, [TINY_PNG].concat(TINY_PNG_DIMS)).should.eventually.eql(TINY_PNG));

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should resize the template if it is bigger than the screen', function callee$2$0() {
      var d, screen, newTemplate;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();
            screen = TINY_PNG_DIMS.map(function (n) {
              return n / 2;
            });
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(d.ensureTemplateSize.apply(d, [TINY_PNG].concat(_toConsumableArray(screen))));

          case 4:
            newTemplate = context$3$0.sent;

            newTemplate.should.not.eql(TINY_PNG);
            newTemplate.length.should.be.below(TINY_PNG.length);

          case 7:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  describe('getScreenshotForImageFind', function () {
    it('should fail if driver does not support getScreenshot', function callee$2$0() {
      var d;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new _.BaseDriver();
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(d.getScreenshotForImageFind().should.eventually.be.rejectedWith(/driver does not support/));

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should not adjust or verify screenshot if asked not to by settings', function callee$2$0() {
      var d, screen;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();

            _sinon2['default'].stub(d, 'getScreenshot').returns(TINY_PNG);
            d.settings.update({ fixImageFindScreenshotDims: false });
            screen = TINY_PNG_DIMS.map(function (n) {
              return n + 1;
            });
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(d.getScreenshotForImageFind.apply(d, _toConsumableArray(screen)).should.eventually.eql(TINY_PNG));

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should return screenshot without adjustment if it matches screen size', function callee$2$0() {
      var d;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();

            _sinon2['default'].stub(d, 'getScreenshot').returns(TINY_PNG);
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(d.getScreenshotForImageFind.apply(d, TINY_PNG_DIMS).should.eventually.eql(TINY_PNG));

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should return scaled screenshot with same aspect ratio if matching screen aspect ratio', function callee$2$0() {
      var d, screen, newScreenshot, screenshotObj;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();

            _sinon2['default'].stub(d, 'getScreenshot').returns(TINY_PNG);
            screen = TINY_PNG_DIMS.map(function (n) {
              return n * 1.5;
            });
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(d.getScreenshotForImageFind.apply(d, _toConsumableArray(screen)));

          case 5:
            newScreenshot = context$3$0.sent;

            newScreenshot.should.not.eql(TINY_PNG);
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(_appiumSupport.imageUtil.getJimpImage(newScreenshot));

          case 9:
            screenshotObj = context$3$0.sent;

            screenshotObj.bitmap.width.should.eql(screen[0]);
            screenshotObj.bitmap.height.should.eql(screen[1]);

          case 12:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should return scaled screenshot with different aspect ratio if not matching screen aspect ratio', function callee$2$0() {
      var d, screen, newScreenshot, screenshotObj;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new TestDriver();

            _sinon2['default'].stub(d, 'getScreenshot').returns(TINY_PNG);

            // try first with portrait screen
            screen = [TINY_PNG_DIMS[0] * 2, TINY_PNG_DIMS[1] * 3];
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(d.getScreenshotForImageFind.apply(d, _toConsumableArray(screen)));

          case 5:
            newScreenshot = context$3$0.sent;

            newScreenshot.should.not.eql(TINY_PNG);
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(_appiumSupport.imageUtil.getJimpImage(newScreenshot));

          case 9:
            screenshotObj = context$3$0.sent;

            screenshotObj.bitmap.width.should.eql(screen[0]);
            screenshotObj.bitmap.height.should.eql(screen[1]);

            // then with landscape screen
            screen = [TINY_PNG_DIMS[0] * 3, TINY_PNG_DIMS[1] * 2];
            context$3$0.next = 15;
            return _regeneratorRuntime.awrap(d.getScreenshotForImageFind.apply(d, _toConsumableArray(screen)));

          case 15:
            newScreenshot = context$3$0.sent;

            newScreenshot.should.not.eql(TINY_PNG);
            context$3$0.next = 19;
            return _regeneratorRuntime.awrap(_appiumSupport.imageUtil.getJimpImage(newScreenshot));

          case 19:
            screenshotObj = context$3$0.sent;

            screenshotObj.bitmap.width.should.eql(screen[0]);
            screenshotObj.bitmap.height.should.eql(screen[1]);

          case 22:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvYmFzZWRyaXZlci9jb21tYW5kcy9maW5kLXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQWlCLE1BQU07Ozs7OEJBQ0ksa0JBQWtCOzs7O3FCQUMzQixPQUFPOzs7O2dCQUNnQixVQUFVOzt5Q0FDcEIsdUNBQXVDOzs2QkFDNUMsZ0JBQWdCOztBQUcxQyxrQkFBSyxNQUFNLEVBQUUsQ0FBQztBQUNkLGtCQUFLLEdBQUcsNkJBQWdCLENBQUM7O0lBRW5CLFVBQVU7WUFBVixVQUFVOztXQUFWLFVBQVU7MEJBQVYsVUFBVTs7K0JBQVYsVUFBVTs7O2VBQVYsVUFBVTs7V0FDTTs7Ozs7Ozs7S0FBSzs7O1dBQ0w7Ozs7Ozs7O0tBQUs7OztTQUZyQixVQUFVOzs7QUFLaEIsSUFBTSxRQUFRLEdBQUcsc3ZDQUFzdkMsQ0FBQztBQUN4d0MsSUFBTSxhQUFhLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7O0FBRTdCLFFBQVEsQ0FBQywyQkFBMkIsRUFBRSxZQUFZO0FBQ2hELFVBQVEsQ0FBQyxhQUFhLEVBQUUsWUFBWTtBQUNsQyxNQUFFLENBQUMsZ0VBQWdFLEVBQUU7VUFDN0QsQ0FBQzs7OztBQUFELGFBQUMsR0FBRyxJQUFJLFVBQVUsRUFBRTs7QUFDMUIsK0JBQU0sSUFBSSxDQUFDLENBQUMsRUFBRSxhQUFhLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDM0MsK0JBQU0sSUFBSSxDQUFDLENBQUMsRUFBRSwyQkFBMkIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQzs7NkNBQ3BELENBQUMsQ0FBQyxXQUFXLDRDQUFpQixLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUUsUUFBSzs7Ozs2Q0FDOUQsQ0FBQyxDQUFDLFlBQVksNENBQWlCLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxRQUFLOzs7Ozs7O0tB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ci9jb21tYW5kcy9maW5kLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xuaW1wb3J0IHsgQmFzZURyaXZlciwgSW1hZ2VFbGVtZW50IH0gZnJvbSAnLi4vLi4vLi4nO1xuaW1wb3J0IHsgSU1BR0VfU1RSQVRFR1kgfSBmcm9tICcuLi8uLi8uLi9saWIvYmFzZWRyaXZlci9jb21tYW5kcy9maW5kJztcbmltcG9ydCB7IGltYWdlVXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcblxuXG5jaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5jbGFzcyBUZXN0RHJpdmVyIGV4dGVuZHMgQmFzZURyaXZlciB7XG4gIGFzeW5jIGdldFdpbmRvd1NpemUgKCkge31cbiAgYXN5bmMgZ2V0U2NyZWVuc2hvdCAoKSB7fVxufVxuXG5jb25zdCBUSU5ZX1BORyA9IFwiaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUFRQUFBQUVDQUlBQUFBbWt3a3BBQUFBR1hSRldIUlRiMlowZDJGeVpRQkJaRzlpWlNCSmJXRm5aVkpsWVdSNWNjbGxQQUFBQXlocFZGaDBXRTFNT21OdmJTNWhaRzlpWlM1NGJYQUFBQUFBQUR3L2VIQmhZMnRsZENCaVpXZHBiajBpNzd1L0lpQnBaRDBpVnpWTk1FMXdRMlZvYVVoNmNtVlRlazVVWTNwcll6bGtJajgrSUR4NE9uaHRjRzFsZEdFZ2VHMXNibk02ZUQwaVlXUnZZbVU2Ym5NNmJXVjBZUzhpSUhnNmVHMXdkR3M5SWtGa2IySmxJRmhOVUNCRGIzSmxJRFV1Tmkxak1UUXdJRGM1TGpFMk1EUTFNU3dnTWpBeE55OHdOUzh3Tmkwd01Ub3dPRG95TVNBZ0lDQWdJQ0FnSWo0Z1BISmtaanBTUkVZZ2VHMXNibk02Y21SbVBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHhPVGs1THpBeUx6SXlMWEprWmkxemVXNTBZWGd0Ym5NaklqNGdQSEprWmpwRVpYTmpjbWx3ZEdsdmJpQnlaR1k2WVdKdmRYUTlJaUlnZUcxc2JuTTZlRzF3UFNKb2RIUndPaTh2Ym5NdVlXUnZZbVV1WTI5dEwzaGhjQzh4TGpBdklpQjRiV3h1Y3pwNGJYQk5UVDBpYUhSMGNEb3ZMMjV6TG1Ga2IySmxMbU52YlM5NFlYQXZNUzR3TDIxdEx5SWdlRzFzYm5NNmMzUlNaV1k5SW1oMGRIQTZMeTl1Y3k1aFpHOWlaUzVqYjIwdmVHRndMekV1TUM5elZIbHdaUzlTWlhOdmRYSmpaVkpsWmlNaUlIaHRjRHBEY21WaGRHOXlWRzl2YkQwaVFXUnZZbVVnVUdodmRHOXphRzl3SUVORElESXdNVGdnS0UxaFkybHVkRzl6YUNraUlIaHRjRTFOT2tsdWMzUmhibU5sU1VROUluaHRjQzVwYVdRNk4wTkRNRE00TURNNE4wVTJNVEZGT0VFek16aEdNVFJGTlVVd056SXdOVUlpSUhodGNFMU5Pa1J2WTNWdFpXNTBTVVE5SW5odGNDNWthV1E2TjBORE1ETTRNRFE0TjBVMk1URkZPRUV6TXpoR01UUkZOVVV3TnpJd05VSWlQaUE4ZUcxd1RVMDZSR1Z5YVhabFpFWnliMjBnYzNSU1pXWTZhVzV6ZEdGdVkyVkpSRDBpZUcxd0xtbHBaRG8zUTBNd016Z3dNVGczUlRZeE1VVTRRVE16T0VZeE5FVTFSVEEzTWpBMVFpSWdjM1JTWldZNlpHOWpkVzFsYm5SSlJEMGllRzF3TG1ScFpEbzNRME13TXpnd01qZzNSVFl4TVVVNFFUTXpPRVl4TkVVMVJUQTNNakExUWlJdlBpQThMM0prWmpwRVpYTmpjbWx3ZEdsdmJqNGdQQzl5WkdZNlVrUkdQaUE4TDNnNmVHMXdiV1YwWVQ0Z1BEOTRjR0ZqYTJWMElHVnVaRDBpY2lJL1BwZHZKalFBQUFBbFNVUkJWSGphSkluQkVRQUFDSUt3L1hlMlVsNXdZQnR3bUpxa2s0K3pmdlVRVm9BQkFFZzBFZnJad2MwaEFBQUFBRWxGVGtTdVFtQ0NcIjtcbmNvbnN0IFRJTllfUE5HX0RJTVMgPSBbNCwgNF07XG5cbmRlc2NyaWJlKCdmaW5kaW5nIGVsZW1lbnRzIGJ5IGltYWdlJywgZnVuY3Rpb24gKCkge1xuICBkZXNjcmliZSgnZmluZEVsZW1lbnQnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCB1c2UgYSBkaWZmZXJlbnQgc3BlY2lhbCBtZXRob2QgdG8gZmluZCBlbGVtZW50IGJ5IGltYWdlJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBUZXN0RHJpdmVyKCk7XG4gICAgICBzaW5vbi5zdHViKGQsICdmaW5kQnlJbWFnZScpLnJldHVybnModHJ1ZSk7XG4gICAgICBzaW5vbi5zdHViKGQsICdmaW5kRWxPckVsc1dpdGhQcm9jZXNzaW5nJykucmV0dXJucyhmYWxzZSk7XG4gICAgICBhd2FpdCBkLmZpbmRFbGVtZW50KElNQUdFX1NUUkFURUdZLCAnZm9vJykuc2hvdWxkLmV2ZW50dWFsbHkuYmUudHJ1ZTtcbiAgICAgIGF3YWl0IGQuZmluZEVsZW1lbnRzKElNQUdFX1NUUkFURUdZLCAnZm9vJykuc2hvdWxkLmV2ZW50dWFsbHkuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIG5vdCBiZSBhYmxlIHRvIGZpbmQgaW1hZ2UgZWxlbWVudCBmcm9tIGFueSBvdGhlciBlbGVtZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBUZXN0RHJpdmVyKCk7XG4gICAgICBhd2FpdCBkLmZpbmRFbGVtZW50RnJvbUVsZW1lbnQoSU1BR0VfU1RSQVRFR1ksICdmb28nLCAnZWxJZCcpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL0xvY2F0b3IgU3RyYXRlZ3kuK2lzIG5vdCBzdXBwb3J0ZWQvKTtcbiAgICAgIGF3YWl0IGQuZmluZEVsZW1lbnRzRnJvbUVsZW1lbnQoSU1BR0VfU1RSQVRFR1ksICdmb28nLCAnZWxJZCcpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL0xvY2F0b3IgU3RyYXRlZ3kuK2lzIG5vdCBzdXBwb3J0ZWQvKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2ZpbmRCeUltYWdlJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHJlY3QgPSB7eDogMTAsIHk6IDIwLCB3aWR0aDogMzAsIGhlaWdodDogNDB9O1xuICAgIGNvbnN0IHNpemUgPSB7d2lkdGg6IDEwMCwgaGVpZ2h0OiAyMDB9O1xuICAgIGNvbnN0IHNjcmVlbnNob3QgPSAnaVZCT1Jmb28nO1xuICAgIGNvbnN0IHRlbXBsYXRlID0gJ2lWQk9SYmFyJztcblxuICAgIGZ1bmN0aW9uIGJhc2ljU3R1YiAoZHJpdmVyKSB7XG4gICAgICBjb25zdCBzaXplU3R1YiA9IHNpbm9uLnN0dWIoZHJpdmVyLCAnZ2V0V2luZG93U2l6ZScpLnJldHVybnMoc2l6ZSk7XG4gICAgICBjb25zdCBzY3JlZW5TdHViID0gc2lub24uc3R1Yihkcml2ZXIsICdnZXRTY3JlZW5zaG90Rm9ySW1hZ2VGaW5kJykucmV0dXJucyhzY3JlZW5zaG90KTtcbiAgICAgIGNvbnN0IGNvbXBhcmVTdHViID0gc2lub24uc3R1Yihkcml2ZXIsICdjb21wYXJlSW1hZ2VzJykucmV0dXJucyh7cmVjdH0pO1xuICAgICAgcmV0dXJuIHtzaXplU3R1Yiwgc2NyZWVuU3R1YiwgY29tcGFyZVN0dWJ9O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJhc2ljSW1nRWxWZXJpZnkgKGltZ0VsUHJvdG8sIGRyaXZlcikge1xuICAgICAgY29uc3QgaW1nRWxJZCA9IGltZ0VsUHJvdG8uRUxFTUVOVDtcbiAgICAgIGRyaXZlci5faW1nRWxDYWNoZS5oYXMoaW1nRWxJZCkuc2hvdWxkLmJlLnRydWU7XG4gICAgICBjb25zdCBpbWdFbCA9IGRyaXZlci5faW1nRWxDYWNoZS5nZXQoaW1nRWxJZCk7XG4gICAgICAoaW1nRWwgaW5zdGFuY2VvZiBJbWFnZUVsZW1lbnQpLnNob3VsZC5iZS50cnVlO1xuICAgICAgaW1nRWwucmVjdC5zaG91bGQuZXFsKHJlY3QpO1xuICAgICAgcmV0dXJuIGltZ0VsO1xuICAgIH1cblxuICAgIGl0KCdzaG91bGQgZmluZCBhbiBpbWFnZSBlbGVtZW50IGhhcHB5cGF0aCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgVGVzdERyaXZlcigpO1xuICAgICAgYmFzaWNTdHViKGQpO1xuICAgICAgY29uc3QgaW1nRWxQcm90byA9IGF3YWl0IGQuZmluZEJ5SW1hZ2UodGVtcGxhdGUsIHttdWx0aXBsZTogZmFsc2V9KTtcbiAgICAgIGJhc2ljSW1nRWxWZXJpZnkoaW1nRWxQcm90bywgZCk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBmaW5kIGltYWdlIGVsZW1lbnRzIGhhcHB5cGF0aCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgVGVzdERyaXZlcigpO1xuICAgICAgYmFzaWNTdHViKGQpO1xuICAgICAgY29uc3QgZWxzID0gYXdhaXQgZC5maW5kQnlJbWFnZSh0ZW1wbGF0ZSwge211bHRpcGxlOiB0cnVlfSk7XG4gICAgICBlbHMuc2hvdWxkLmhhdmUubGVuZ3RoKDEpO1xuICAgICAgYmFzaWNJbWdFbFZlcmlmeShlbHNbMF0sIGQpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgZmFpbCBpZiBkcml2ZXIgZG9lcyBub3Qgc3VwcG9ydCBnZXRXaW5kb3dTaXplJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBCYXNlRHJpdmVyKCk7XG4gICAgICBhd2FpdCBkLmZpbmRCeUltYWdlKHRlbXBsYXRlLCB7bXVsdGlwbGU6IGZhbHNlfSlcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvZHJpdmVyIGRvZXMgbm90IHN1cHBvcnQvKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGZpeCB0ZW1wbGF0ZSBzaXplIGlmIHJlcXVlc3RlZCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgVGVzdERyaXZlcigpO1xuICAgICAgY29uc3QgbmV3VGVtcGxhdGUgPSAnaVZCT1JiYXonO1xuICAgICAgY29uc3Qge2NvbXBhcmVTdHVifSA9IGJhc2ljU3R1YihkKTtcbiAgICAgIGF3YWl0IGQuc2V0dGluZ3MudXBkYXRlKHtmaXhJbWFnZVRlbXBsYXRlU2l6ZTogdHJ1ZX0pO1xuICAgICAgc2lub24uc3R1YihkLCAnZW5zdXJlVGVtcGxhdGVTaXplJykucmV0dXJucyhuZXdUZW1wbGF0ZSk7XG4gICAgICBjb25zdCBpbWdFbFByb3RvID0gYXdhaXQgZC5maW5kQnlJbWFnZSh0ZW1wbGF0ZSwge211bHRpcGxlOiBmYWxzZX0pO1xuICAgICAgY29uc3QgaW1nRWwgPSBiYXNpY0ltZ0VsVmVyaWZ5KGltZ0VsUHJvdG8sIGQpO1xuICAgICAgaW1nRWwudGVtcGxhdGUuc2hvdWxkLmVxbChuZXdUZW1wbGF0ZSk7XG4gICAgICBjb21wYXJlU3R1Yi5hcmdzWzBdWzJdLnNob3VsZC5lcWwobmV3VGVtcGxhdGUpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdGhyb3cgYW4gZXJyb3IgaWYgdGVtcGxhdGUgbWF0Y2ggZmFpbHMnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IFRlc3REcml2ZXIoKTtcbiAgICAgIGNvbnN0IHtjb21wYXJlU3R1Yn0gPSBiYXNpY1N0dWIoZCk7XG4gICAgICBjb21wYXJlU3R1Yi50aHJvd3MobmV3IEVycm9yKCdDYW5ub3QgZmluZCBhbnkgb2NjdXJyZW5jZXMnKSk7XG4gICAgICBhd2FpdCBkLmZpbmRCeUltYWdlKHRlbXBsYXRlLCB7bXVsdGlwbGU6IGZhbHNlfSlcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvZWxlbWVudCBjb3VsZCBub3QgYmUgbG9jYXRlZC8pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGVtcHR5IGFycmF5IGZvciBtdWx0aXBsZSBlbGVtZW50cyBpZiB0ZW1wbGF0ZSBtYXRjaCBmYWlscycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgVGVzdERyaXZlcigpO1xuICAgICAgY29uc3Qge2NvbXBhcmVTdHVifSA9IGJhc2ljU3R1YihkKTtcbiAgICAgIGNvbXBhcmVTdHViLnRocm93cyhuZXcgRXJyb3IoJ0Nhbm5vdCBmaW5kIGFueSBvY2N1cnJlbmNlcycpKTtcbiAgICAgIGF3YWl0IGQuZmluZEJ5SW1hZ2UodGVtcGxhdGUsIHttdWx0aXBsZTogdHJ1ZX0pLnNob3VsZC5ldmVudHVhbGx5LmVxbChbXSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCByZXNwZWN0IGltcGxpY2l0IHdhaXQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IFRlc3REcml2ZXIoKTtcbiAgICAgIGQuc2V0SW1wbGljaXRXYWl0KDEwKTtcbiAgICAgIGNvbnN0IHtjb21wYXJlU3R1Yn0gPSBiYXNpY1N0dWIoZCk7XG4gICAgICBjb21wYXJlU3R1Yi5vbkNhbGwoMCkudGhyb3dzKG5ldyBFcnJvcignQ2Fubm90IGZpbmQgYW55IG9jY3VycmVuY2VzJykpO1xuICAgICAgY29uc3QgaW1nRWxQcm90byA9IGF3YWl0IGQuZmluZEJ5SW1hZ2UodGVtcGxhdGUsIHttdWx0aXBsZTogZmFsc2V9KTtcbiAgICAgIGJhc2ljSW1nRWxWZXJpZnkoaW1nRWxQcm90bywgZCk7XG4gICAgICBjb21wYXJlU3R1Yi5jYWxsQ291bnQuc2hvdWxkLmVxbCgyKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIG5vdCBhZGQgZWxlbWVudCB0byBjYWNoZSBhbmQgcmV0dXJuIGl0IGRpcmVjdGx5IHdoZW4gY2hlY2tpbmcgc3RhbGVuZXNzJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBUZXN0RHJpdmVyKCk7XG4gICAgICBiYXNpY1N0dWIoZCk7XG4gICAgICBjb25zdCBpbWdFbCA9IGF3YWl0IGQuZmluZEJ5SW1hZ2UodGVtcGxhdGUsIHttdWx0aXBsZTogZmFsc2UsIHNob3VsZENoZWNrU3RhbGVuZXNzOiB0cnVlfSk7XG4gICAgICAoaW1nRWwgaW5zdGFuY2VvZiBJbWFnZUVsZW1lbnQpLnNob3VsZC5iZS50cnVlO1xuICAgICAgZC5faW1nRWxDYWNoZS5oYXMoaW1nRWwuaWQpLnNob3VsZC5iZS5mYWxzZTtcbiAgICAgIGltZ0VsLnJlY3Quc2hvdWxkLmVxbChyZWN0KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2Vuc3VyZVRlbXBsYXRlU2l6ZScsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIG5vdCByZXNpemUgdGhlIHRlbXBsYXRlIGlmIGl0IGlzIHNtYWxsZXIgdGhhbiB0aGUgc2NyZWVuJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3Qgc2NyZWVuID0gVElOWV9QTkdfRElNUy5tYXAobiA9PiBuICogMik7XG4gICAgICBjb25zdCBkID0gbmV3IFRlc3REcml2ZXIoKTtcbiAgICAgIGF3YWl0IGQuZW5zdXJlVGVtcGxhdGVTaXplKFRJTllfUE5HLCAuLi5zY3JlZW4pXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5lcWwoVElOWV9QTkcpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgbm90IHJlc2l6ZSB0aGUgdGVtcGxhdGUgaWYgaXQgaXMgdGhlIHNhbWUgc2l6ZSBhcyB0aGUgc2NyZWVuJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBUZXN0RHJpdmVyKCk7XG4gICAgICBhd2FpdCBkLmVuc3VyZVRlbXBsYXRlU2l6ZShUSU5ZX1BORywgLi4uVElOWV9QTkdfRElNUylcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmVxbChUSU5ZX1BORyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCByZXNpemUgdGhlIHRlbXBsYXRlIGlmIGl0IGlzIGJpZ2dlciB0aGFuIHRoZSBzY3JlZW4nLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IFRlc3REcml2ZXIoKTtcbiAgICAgIGNvbnN0IHNjcmVlbiA9IFRJTllfUE5HX0RJTVMubWFwKG4gPT4gbiAvIDIpO1xuICAgICAgY29uc3QgbmV3VGVtcGxhdGUgPSBhd2FpdCBkLmVuc3VyZVRlbXBsYXRlU2l6ZShUSU5ZX1BORywgLi4uc2NyZWVuKTtcbiAgICAgIG5ld1RlbXBsYXRlLnNob3VsZC5ub3QuZXFsKFRJTllfUE5HKTtcbiAgICAgIG5ld1RlbXBsYXRlLmxlbmd0aC5zaG91bGQuYmUuYmVsb3coVElOWV9QTkcubGVuZ3RoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldFNjcmVlbnNob3RGb3JJbWFnZUZpbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCBmYWlsIGlmIGRyaXZlciBkb2VzIG5vdCBzdXBwb3J0IGdldFNjcmVlbnNob3QnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IEJhc2VEcml2ZXIoKTtcbiAgICAgIGF3YWl0IGQuZ2V0U2NyZWVuc2hvdEZvckltYWdlRmluZCgpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL2RyaXZlciBkb2VzIG5vdCBzdXBwb3J0Lyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBub3QgYWRqdXN0IG9yIHZlcmlmeSBzY3JlZW5zaG90IGlmIGFza2VkIG5vdCB0byBieSBzZXR0aW5ncycsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgVGVzdERyaXZlcigpO1xuICAgICAgc2lub24uc3R1YihkLCAnZ2V0U2NyZWVuc2hvdCcpLnJldHVybnMoVElOWV9QTkcpO1xuICAgICAgZC5zZXR0aW5ncy51cGRhdGUoe2ZpeEltYWdlRmluZFNjcmVlbnNob3REaW1zOiBmYWxzZX0pO1xuICAgICAgY29uc3Qgc2NyZWVuID0gVElOWV9QTkdfRElNUy5tYXAobiA9PiBuICsgMSk7XG4gICAgICBhd2FpdCBkLmdldFNjcmVlbnNob3RGb3JJbWFnZUZpbmQoLi4uc2NyZWVuKVxuICAgICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuZXFsKFRJTllfUE5HKTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBzY3JlZW5zaG90IHdpdGhvdXQgYWRqdXN0bWVudCBpZiBpdCBtYXRjaGVzIHNjcmVlbiBzaXplJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBUZXN0RHJpdmVyKCk7XG4gICAgICBzaW5vbi5zdHViKGQsICdnZXRTY3JlZW5zaG90JykucmV0dXJucyhUSU5ZX1BORyk7XG4gICAgICBhd2FpdCBkLmdldFNjcmVlbnNob3RGb3JJbWFnZUZpbmQoLi4uVElOWV9QTkdfRElNUylcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmVxbChUSU5ZX1BORyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gc2NhbGVkIHNjcmVlbnNob3Qgd2l0aCBzYW1lIGFzcGVjdCByYXRpbyBpZiBtYXRjaGluZyBzY3JlZW4gYXNwZWN0IHJhdGlvJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBUZXN0RHJpdmVyKCk7XG4gICAgICBzaW5vbi5zdHViKGQsICdnZXRTY3JlZW5zaG90JykucmV0dXJucyhUSU5ZX1BORyk7XG4gICAgICBjb25zdCBzY3JlZW4gPSBUSU5ZX1BOR19ESU1TLm1hcChuID0+IG4gKiAxLjUpO1xuICAgICAgY29uc3QgbmV3U2NyZWVuc2hvdCA9IGF3YWl0IGQuZ2V0U2NyZWVuc2hvdEZvckltYWdlRmluZCguLi5zY3JlZW4pO1xuICAgICAgbmV3U2NyZWVuc2hvdC5zaG91bGQubm90LmVxbChUSU5ZX1BORyk7XG4gICAgICBjb25zdCBzY3JlZW5zaG90T2JqID0gYXdhaXQgaW1hZ2VVdGlsLmdldEppbXBJbWFnZShuZXdTY3JlZW5zaG90KTtcbiAgICAgIHNjcmVlbnNob3RPYmouYml0bWFwLndpZHRoLnNob3VsZC5lcWwoc2NyZWVuWzBdKTtcbiAgICAgIHNjcmVlbnNob3RPYmouYml0bWFwLmhlaWdodC5zaG91bGQuZXFsKHNjcmVlblsxXSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gc2NhbGVkIHNjcmVlbnNob3Qgd2l0aCBkaWZmZXJlbnQgYXNwZWN0IHJhdGlvIGlmIG5vdCBtYXRjaGluZyBzY3JlZW4gYXNwZWN0IHJhdGlvJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgY29uc3QgZCA9IG5ldyBUZXN0RHJpdmVyKCk7XG4gICAgICBzaW5vbi5zdHViKGQsICdnZXRTY3JlZW5zaG90JykucmV0dXJucyhUSU5ZX1BORyk7XG5cbiAgICAgIC8vIHRyeSBmaXJzdCB3aXRoIHBvcnRyYWl0IHNjcmVlblxuICAgICAgbGV0IHNjcmVlbiA9IFtUSU5ZX1BOR19ESU1TWzBdICogMiwgVElOWV9QTkdfRElNU1sxXSAqIDNdO1xuICAgICAgbGV0IG5ld1NjcmVlbnNob3QgPSBhd2FpdCBkLmdldFNjcmVlbnNob3RGb3JJbWFnZUZpbmQoLi4uc2NyZWVuKTtcbiAgICAgIG5ld1NjcmVlbnNob3Quc2hvdWxkLm5vdC5lcWwoVElOWV9QTkcpO1xuICAgICAgbGV0IHNjcmVlbnNob3RPYmogPSBhd2FpdCBpbWFnZVV0aWwuZ2V0SmltcEltYWdlKG5ld1NjcmVlbnNob3QpO1xuICAgICAgc2NyZWVuc2hvdE9iai5iaXRtYXAud2lkdGguc2hvdWxkLmVxbChzY3JlZW5bMF0pO1xuICAgICAgc2NyZWVuc2hvdE9iai5iaXRtYXAuaGVpZ2h0LnNob3VsZC5lcWwoc2NyZWVuWzFdKTtcblxuICAgICAgLy8gdGhlbiB3aXRoIGxhbmRzY2FwZSBzY3JlZW5cbiAgICAgIHNjcmVlbiA9IFtUSU5ZX1BOR19ESU1TWzBdICogMywgVElOWV9QTkdfRElNU1sxXSAqIDJdO1xuICAgICAgbmV3U2NyZWVuc2hvdCA9IGF3YWl0IGQuZ2V0U2NyZWVuc2hvdEZvckltYWdlRmluZCguLi5zY3JlZW4pO1xuICAgICAgbmV3U2NyZWVuc2hvdC5zaG91bGQubm90LmVxbChUSU5ZX1BORyk7XG4gICAgICBzY3JlZW5zaG90T2JqID0gYXdhaXQgaW1hZ2VVdGlsLmdldEppbXBJbWFnZShuZXdTY3JlZW5zaG90KTtcbiAgICAgIHNjcmVlbnNob3RPYmouYml0bWFwLndpZHRoLnNob3VsZC5lcWwoc2NyZWVuWzBdKTtcbiAgICAgIHNjcmVlbnNob3RPYmouYml0bWFwLmhlaWdodC5zaG91bGQuZXFsKHNjcmVlblsxXSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uIn0=
