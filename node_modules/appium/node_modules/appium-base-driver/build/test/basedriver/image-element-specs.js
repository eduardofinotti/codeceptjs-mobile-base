'use strict';

var _extends = require('babel-runtime/helpers/extends')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _2 = require('../..');

var _3 = _interopRequireDefault(_2);

var _libBasedriverImageElement = require('../../lib/basedriver/image-element');

var _libProtocolProtocol = require('../../lib/protocol/protocol');

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var defRect = { x: 100, y: 110, width: 50, height: 25 };
var defTemplate = 'iVBORasdf';

describe('ImageElement', function () {
  var driver = new _3['default']();

  describe('.size', function () {
    it('should return the width and height of the image el', function () {
      var el = new _2.ImageElement(defTemplate, defRect);
      el.size.should.eql({ width: defRect.width, height: defRect.height });
    });
  });

  describe('.location', function () {
    it('should return the location of the image el', function () {
      var el = new _2.ImageElement(defTemplate, defRect);
      el.location.should.eql({ x: defRect.x, y: defRect.y });
    });
  });

  describe('.center', function () {
    it('should return the center location of the image el', function () {
      var el = new _2.ImageElement(defTemplate, defRect);
      el.center.should.eql({
        x: defRect.x + defRect.width / 2,
        y: defRect.y + defRect.height / 2
      });
    });
  });

  describe('.asElement', function () {
    it('should get the webdriver object representation of the element', function () {
      var el = new _2.ImageElement(defTemplate, defRect);
      el.asElement("ELEMENT").ELEMENT.should.match(/^appium-image-el/);
    });
  });

  describe('.equals', function () {
    it('should say two image elements with same rect are equal', function () {
      var el1 = new _2.ImageElement('foo', defRect);
      var el2 = new _2.ImageElement('bar', defRect);
      el1.equals(el2).should.be['true'];
      el2.equals(el1).should.be['true'];
    });
    it('should say two image elements with different rect are not equal', function () {
      var el1 = new _2.ImageElement(defTemplate, _extends({}, defRect, { x: 0 }));
      var el2 = new _2.ImageElement(defTemplate, defRect);
      el1.equals(el2).should.be['false'];
      el2.equals(el1).should.be['false'];
    });
  });

  describe('.click', function () {
    it('should reject an invalid tap strategy', function callee$2$0() {
      var d, el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new _3['default']();
            el = new _2.ImageElement(defTemplate, defRect);
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(d.settings.update({ imageElementTapStrategy: 'bad' }));

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(el.click(d).should.eventually.be.rejectedWith(/Incorrect imageElementTapStrategy/));

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should try to check for image element staleness, and throw if stale', function callee$2$0() {
      var d, el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new _3['default']();

            _sinon2['default'].stub(d, 'findByImage').throws();
            el = new _2.ImageElement(defTemplate, defRect);
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(d.settings.update({
              checkForImageElementStaleness: true,
              autoUpdateImageElementPosition: false
            }));

          case 5:
            context$3$0.next = 7;
            return _regeneratorRuntime.awrap(el.click(d).should.eventually.be.rejectedWith(/no longer attached/));

          case 7:
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(d.settings.update({
              checkForImageElementStaleness: false,
              autoUpdateImageElementPosition: true
            }));

          case 9:
            context$3$0.next = 11;
            return _regeneratorRuntime.awrap(el.click(d).should.eventually.be.rejectedWith(/no longer attached/));

          case 11:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should auto-update element position if requested', function callee$2$0() {
      var d, el, newRect, elPos2;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new _3['default']();

            d.performActions = _lodash2['default'].noop;
            _sinon2['default'].stub(d, 'performActions');
            el = new _2.ImageElement(defTemplate, defRect);
            newRect = _extends({}, defRect, { x: defRect.x + 10, y: defRect.y + 5 });
            elPos2 = new _2.ImageElement(defTemplate, newRect);

            _sinon2['default'].stub(d, 'findByImage').returns(elPos2);
            context$3$0.next = 9;
            return _regeneratorRuntime.awrap(d.settings.update({
              autoUpdateImageElementPosition: true
            }));

          case 9:
            el.rect.should.not.eql(newRect);
            context$3$0.next = 12;
            return _regeneratorRuntime.awrap(el.click(d));

          case 12:
            el.rect.should.eql(newRect);

          case 13:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should tap the center of an element using w3c actions by default', function callee$2$0() {
      var d, actionStub, el, pointerMoveAction;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new _3['default']();

            d.performActions = _lodash2['default'].noop;
            actionStub = _sinon2['default'].stub(d, 'performActions');
            el = new _2.ImageElement(defTemplate, defRect);
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(d.settings.update({
              checkForImageElementStaleness: false
            }));

          case 6:
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap(el.click(d));

          case 8:
            pointerMoveAction = actionStub.args[0][0][0].actions[0];

            pointerMoveAction.x.should.equal(el.center.x);
            pointerMoveAction.y.should.equal(el.center.y);

          case 11:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should fall back to touchactions if w3c actions do not exist on driver', function callee$2$0() {
      var d, actionStub, el, action;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new _3['default']();

            d.performTouch = _lodash2['default'].noop;
            actionStub = _sinon2['default'].stub(d, 'performTouch');
            el = new _2.ImageElement(defTemplate, defRect);
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(d.settings.update({
              checkForImageElementStaleness: false
            }));

          case 6:
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap(el.click(d));

          case 8:
            action = actionStub.args[0][0][0].options;

            action.x.should.equal(el.center.x);
            action.y.should.equal(el.center.y);

          case 11:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should use touchactions if requested', function callee$2$0() {
      var d, w3cStub, touchStub, el, action;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new _3['default']();

            d.performActions = _lodash2['default'].noop;
            w3cStub = _sinon2['default'].stub(d, 'performActions');

            d.performTouch = _lodash2['default'].noop;
            touchStub = _sinon2['default'].stub(d, 'performTouch');
            el = new _2.ImageElement(defTemplate, defRect);
            context$3$0.next = 8;
            return _regeneratorRuntime.awrap(d.settings.update({
              checkForImageElementStaleness: false,
              imageElementTapStrategy: 'touchActions'
            }));

          case 8:
            context$3$0.next = 10;
            return _regeneratorRuntime.awrap(el.click(d));

          case 10:
            action = touchStub.args[0][0][0].options;

            action.x.should.equal(el.center.x);
            action.y.should.equal(el.center.y);
            w3cStub.callCount.should.eql(0);

          case 14:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should throw if driver does not implement any type of action', function callee$2$0() {
      var d, el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            d = new _3['default']();
            el = new _2.ImageElement(defTemplate, defRect);
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(d.settings.update({
              checkForImageElementStaleness: false
            }));

          case 4:
            context$3$0.next = 6;
            return _regeneratorRuntime.awrap(el.click(d).should.eventually.be.rejectedWith(/did not implement/));

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });

  describe('#execute', function () {
    var imgEl = new _2.ImageElement(defTemplate, defRect);
    var clickStub = _sinon2['default'].stub(imgEl, 'click');

    before(function () {
      driver._imgElCache.set(imgEl.id, imgEl);
      clickStub.returns(true);
    });

    after(function () {
      driver._imgElCache.reset();
      clickStub.restore();
    });

    it('should reject executions on elements not in the cache', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_2.ImageElement.execute(driver, 'click', 'appium-image-element-foo').should.eventually.be.rejectedWith(/element could not be located/));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should reject executions for unsupported commands', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_2.ImageElement.execute(driver, 'foobar', imgEl.id).should.eventually.be.rejectedWith(/not yet been implemented/));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should get displayed status of element', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_2.ImageElement.execute(driver, 'elementDisplayed', imgEl.id).should.eventually.be['true']);

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should get size of element', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_2.ImageElement.execute(driver, 'getSize', imgEl.id).should.eventually.eql({ width: defRect.width, height: defRect.height }));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should get location of element', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_2.ImageElement.execute(driver, 'getLocation', imgEl.id).should.eventually.eql({ x: defRect.x, y: defRect.y }));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should get location in view of element', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_2.ImageElement.execute(driver, 'getLocation', imgEl.id).should.eventually.eql({ x: defRect.x, y: defRect.y }));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should get rect of element', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_2.ImageElement.execute(driver, 'getElementRect', imgEl.id).should.eventually.eql(defRect));

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
    it('should click element', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(_2.ImageElement.execute(driver, 'click', imgEl.id).should.eventually.be['true']);

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, this);
    });
  });
});

describe('image element LRU cache', function () {
  it('should accept and cache image elements', function () {
    var el1 = new _2.ImageElement(defTemplate, defRect);
    var el2 = new _2.ImageElement(defTemplate, defRect);
    var cache = (0, _libBasedriverImageElement.makeImageElementCache)();
    cache.set(el1.id, el1);
    el1.equals(cache.get(el1.id)).should.be['true'];
    _lodash2['default'].isUndefined(cache.get(el2.id)).should.be['true'];
    cache.has(el1.id).should.be['true'];
    cache.has(el2.id).should.be['false'];
  });
  it('once cache reaches max size, should eject image elements', function () {
    var el1 = new _2.ImageElement(defTemplate, defRect);
    var el2 = new _2.ImageElement(defTemplate, defRect);
    var cache = (0, _libBasedriverImageElement.makeImageElementCache)(defTemplate.length + 1);
    cache.set(el1.id, el1);
    cache.has(el1.id).should.be['true'];
    cache.set(el2.id, el2);
    cache.has(el2.id).should.be['true'];
    cache.has(el1.id).should.be['false'];
  });
});

describe('getImgElFromArgs', function () {
  it('should return the image element id from json obj in args', function () {
    var imgEl = _libProtocolProtocol.IMAGE_ELEMENT_PREFIX + 'foo';
    var args = [1, 'foo', imgEl];
    (0, _libBasedriverImageElement.getImgElFromArgs)(args).should.eql(imgEl);
  });
  it('should not return anything if image element id not in args', function () {
    var args = [1, 'foo'];
    _lodash2['default'].isUndefined((0, _libBasedriverImageElement.getImgElFromArgs)(args)).should.be['true'];
  });
  it('should not find image element id in anything but prefix', function () {
    var notImgEl = 'foo' + _libProtocolProtocol.IMAGE_ELEMENT_PREFIX;
    var args = [1, 'foo', notImgEl];
    _lodash2['default'].isUndefined((0, _libBasedriverImageElement.getImgElFromArgs)(args)).should.be['true'];
  });
});

// we need to check for staleness if explicitly requested to do so

// and also if we are updating the element position

// skip the staleness check for this test

// skip the staleness check for this test

// skip the staleness check for this test

// skip the staleness check for this test
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvYmFzZWRyaXZlci9pbWFnZS1lbGVtZW50LXNwZWNzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O3NCQUFjLFFBQVE7Ozs7b0JBQ0wsTUFBTTs7Ozs4QkFDSSxrQkFBa0I7Ozs7aUJBQ0osT0FBTzs7Ozt5Q0FDUSxvQ0FBb0M7O21DQUN2RCw2QkFBNkI7O3FCQUNoRCxPQUFPOzs7O0FBR3pCLGtCQUFLLE1BQU0sRUFBRSxDQUFDO0FBQ2Qsa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFHekIsSUFBTSxPQUFPLEdBQUcsRUFBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFDLENBQUM7QUFDeEQsSUFBTSxXQUFXLEdBQUcsV0FBVyxDQUFDOztBQUVoQyxRQUFRLENBQUMsY0FBYyxFQUFFLFlBQVk7QUFDbkMsTUFBTSxNQUFNLEdBQUcsbUJBQWdCLENBQUM7O0FBRWhDLFVBQVEsQ0FBQyxPQUFPLEVBQUUsWUFBWTtBQUM1QixNQUFFLENBQUMsb0RBQW9ELEVBQUUsWUFBWTtBQUNuRSxVQUFNLEVBQUUsR0FBRyxvQkFBaUIsV0FBVyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ2xELFFBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTSxFQUFDLENBQUMsQ0FBQztLQUNwRSxDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7O0FBRUgsVUFBUSxDQUFDLFdBQVcsRUFBRSxZQUFZO0FBQ2hDLE1BQUUsQ0FBQyw0Q0FBNEMsRUFBRSxZQUFZO0FBQzNELFVBQU0sRUFBRSxHQUFHLG9CQUFpQixXQUFXLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDbEQsUUFBRSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUMs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LFdBQVcsQ0FBQyxpREFBaUIsSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxRQUFLLENBQUM7R0FDdEQsQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3QvYmFzZWRyaXZlci9pbWFnZS1lbGVtZW50LXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBjaGFpIGZyb20gJ2NoYWknO1xuaW1wb3J0IGNoYWlBc1Byb21pc2VkIGZyb20gJ2NoYWktYXMtcHJvbWlzZWQnO1xuaW1wb3J0IEJhc2VEcml2ZXIsIHsgSW1hZ2VFbGVtZW50IH0gZnJvbSAnLi4vLi4nO1xuaW1wb3J0IHsgbWFrZUltYWdlRWxlbWVudENhY2hlLCBnZXRJbWdFbEZyb21BcmdzIH0gZnJvbSAnLi4vLi4vbGliL2Jhc2Vkcml2ZXIvaW1hZ2UtZWxlbWVudCc7XG5pbXBvcnQgeyBJTUFHRV9FTEVNRU5UX1BSRUZJWCB9IGZyb20gJy4uLy4uL2xpYi9wcm90b2NvbC9wcm90b2NvbCc7XG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xuXG5cbmNoYWkuc2hvdWxkKCk7XG5jaGFpLnVzZShjaGFpQXNQcm9taXNlZCk7XG5cblxuY29uc3QgZGVmUmVjdCA9IHt4OiAxMDAsIHk6IDExMCwgd2lkdGg6IDUwLCBoZWlnaHQ6IDI1fTtcbmNvbnN0IGRlZlRlbXBsYXRlID0gJ2lWQk9SYXNkZic7XG5cbmRlc2NyaWJlKCdJbWFnZUVsZW1lbnQnLCBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IGRyaXZlciA9IG5ldyBCYXNlRHJpdmVyKCk7XG5cbiAgZGVzY3JpYmUoJy5zaXplJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IG9mIHRoZSBpbWFnZSBlbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICBlbC5zaXplLnNob3VsZC5lcWwoe3dpZHRoOiBkZWZSZWN0LndpZHRoLCBoZWlnaHQ6IGRlZlJlY3QuaGVpZ2h0fSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCcubG9jYXRpb24nLCBmdW5jdGlvbiAoKSB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdGhlIGxvY2F0aW9uIG9mIHRoZSBpbWFnZSBlbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICBlbC5sb2NhdGlvbi5zaG91bGQuZXFsKHt4OiBkZWZSZWN0LngsIHk6IGRlZlJlY3QueX0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnLmNlbnRlcicsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiB0aGUgY2VudGVyIGxvY2F0aW9uIG9mIHRoZSBpbWFnZSBlbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICBlbC5jZW50ZXIuc2hvdWxkLmVxbCh7XG4gICAgICAgIHg6IGRlZlJlY3QueCArIGRlZlJlY3Qud2lkdGggLyAyLFxuICAgICAgICB5OiBkZWZSZWN0LnkgKyBkZWZSZWN0LmhlaWdodCAvIDJcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnLmFzRWxlbWVudCcsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIGdldCB0aGUgd2ViZHJpdmVyIG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiB0aGUgZWxlbWVudCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICBlbC5hc0VsZW1lbnQoXCJFTEVNRU5UXCIpLkVMRU1FTlQuc2hvdWxkLm1hdGNoKC9eYXBwaXVtLWltYWdlLWVsLyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCcuZXF1YWxzJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgc2F5IHR3byBpbWFnZSBlbGVtZW50cyB3aXRoIHNhbWUgcmVjdCBhcmUgZXF1YWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBlbDEgPSBuZXcgSW1hZ2VFbGVtZW50KCdmb28nLCBkZWZSZWN0KTtcbiAgICAgIGNvbnN0IGVsMiA9IG5ldyBJbWFnZUVsZW1lbnQoJ2JhcicsIGRlZlJlY3QpO1xuICAgICAgZWwxLmVxdWFscyhlbDIpLnNob3VsZC5iZS50cnVlO1xuICAgICAgZWwyLmVxdWFscyhlbDEpLnNob3VsZC5iZS50cnVlO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgc2F5IHR3byBpbWFnZSBlbGVtZW50cyB3aXRoIGRpZmZlcmVudCByZWN0IGFyZSBub3QgZXF1YWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBlbDEgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCB7Li4uZGVmUmVjdCwgeDogMH0pO1xuICAgICAgY29uc3QgZWwyID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICBlbDEuZXF1YWxzKGVsMikuc2hvdWxkLmJlLmZhbHNlO1xuICAgICAgZWwyLmVxdWFscyhlbDEpLnNob3VsZC5iZS5mYWxzZTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJy5jbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIHJlamVjdCBhbiBpbnZhbGlkIHRhcCBzdHJhdGVneScsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgQmFzZURyaXZlcigpO1xuICAgICAgY29uc3QgZWwgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICAgIGF3YWl0IGQuc2V0dGluZ3MudXBkYXRlKHtpbWFnZUVsZW1lbnRUYXBTdHJhdGVneTogJ2JhZCd9KTtcbiAgICAgIGF3YWl0IGVsLmNsaWNrKGQpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvSW5jb3JyZWN0IGltYWdlRWxlbWVudFRhcFN0cmF0ZWd5Lyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0cnkgdG8gY2hlY2sgZm9yIGltYWdlIGVsZW1lbnQgc3RhbGVuZXNzLCBhbmQgdGhyb3cgaWYgc3RhbGUnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IEJhc2VEcml2ZXIoKTtcbiAgICAgIHNpbm9uLnN0dWIoZCwgJ2ZpbmRCeUltYWdlJykudGhyb3dzKCk7XG4gICAgICBjb25zdCBlbCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgLy8gd2UgbmVlZCB0byBjaGVjayBmb3Igc3RhbGVuZXNzIGlmIGV4cGxpY2l0bHkgcmVxdWVzdGVkIHRvIGRvIHNvXG4gICAgICBhd2FpdCBkLnNldHRpbmdzLnVwZGF0ZSh7XG4gICAgICAgIGNoZWNrRm9ySW1hZ2VFbGVtZW50U3RhbGVuZXNzOiB0cnVlLFxuICAgICAgICBhdXRvVXBkYXRlSW1hZ2VFbGVtZW50UG9zaXRpb246IGZhbHNlXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IGVsLmNsaWNrKGQpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvbm8gbG9uZ2VyIGF0dGFjaGVkLyk7XG5cbiAgICAgIC8vIGFuZCBhbHNvIGlmIHdlIGFyZSB1cGRhdGluZyB0aGUgZWxlbWVudCBwb3NpdGlvblxuICAgICAgYXdhaXQgZC5zZXR0aW5ncy51cGRhdGUoe1xuICAgICAgICBjaGVja0ZvckltYWdlRWxlbWVudFN0YWxlbmVzczogZmFsc2UsXG4gICAgICAgIGF1dG9VcGRhdGVJbWFnZUVsZW1lbnRQb3NpdGlvbjogdHJ1ZVxuICAgICAgfSk7XG4gICAgICBhd2FpdCBlbC5jbGljayhkKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZFdpdGgoL25vIGxvbmdlciBhdHRhY2hlZC8pO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgYXV0by11cGRhdGUgZWxlbWVudCBwb3NpdGlvbiBpZiByZXF1ZXN0ZWQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IEJhc2VEcml2ZXIoKTtcbiAgICAgIGQucGVyZm9ybUFjdGlvbnMgPSBfLm5vb3A7XG4gICAgICBzaW5vbi5zdHViKGQsICdwZXJmb3JtQWN0aW9ucycpO1xuICAgICAgY29uc3QgZWwgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICAgIGNvbnN0IG5ld1JlY3QgPSB7Li4uZGVmUmVjdCwgeDogZGVmUmVjdC54ICsgMTAsIHk6IGRlZlJlY3QueSArIDV9O1xuICAgICAgY29uc3QgZWxQb3MyID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgbmV3UmVjdCk7XG4gICAgICBzaW5vbi5zdHViKGQsICdmaW5kQnlJbWFnZScpLnJldHVybnMoZWxQb3MyKTtcbiAgICAgIGF3YWl0IGQuc2V0dGluZ3MudXBkYXRlKHtcbiAgICAgICAgYXV0b1VwZGF0ZUltYWdlRWxlbWVudFBvc2l0aW9uOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICBlbC5yZWN0LnNob3VsZC5ub3QuZXFsKG5ld1JlY3QpO1xuICAgICAgYXdhaXQgZWwuY2xpY2soZCk7XG4gICAgICBlbC5yZWN0LnNob3VsZC5lcWwobmV3UmVjdCk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB0YXAgdGhlIGNlbnRlciBvZiBhbiBlbGVtZW50IHVzaW5nIHczYyBhY3Rpb25zIGJ5IGRlZmF1bHQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IEJhc2VEcml2ZXIoKTtcbiAgICAgIGQucGVyZm9ybUFjdGlvbnMgPSBfLm5vb3A7XG4gICAgICBjb25zdCBhY3Rpb25TdHViID0gc2lub24uc3R1YihkLCAncGVyZm9ybUFjdGlvbnMnKTtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICAvLyBza2lwIHRoZSBzdGFsZW5lc3MgY2hlY2sgZm9yIHRoaXMgdGVzdFxuICAgICAgYXdhaXQgZC5zZXR0aW5ncy51cGRhdGUoe1xuICAgICAgICBjaGVja0ZvckltYWdlRWxlbWVudFN0YWxlbmVzczogZmFsc2UsXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IGVsLmNsaWNrKGQpO1xuICAgICAgY29uc3QgcG9pbnRlck1vdmVBY3Rpb24gPSBhY3Rpb25TdHViLmFyZ3NbMF1bMF1bMF0uYWN0aW9uc1swXTtcbiAgICAgIHBvaW50ZXJNb3ZlQWN0aW9uLnguc2hvdWxkLmVxdWFsKGVsLmNlbnRlci54KTtcbiAgICAgIHBvaW50ZXJNb3ZlQWN0aW9uLnkuc2hvdWxkLmVxdWFsKGVsLmNlbnRlci55KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGZhbGwgYmFjayB0byB0b3VjaGFjdGlvbnMgaWYgdzNjIGFjdGlvbnMgZG8gbm90IGV4aXN0IG9uIGRyaXZlcicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgQmFzZURyaXZlcigpO1xuICAgICAgZC5wZXJmb3JtVG91Y2ggPSBfLm5vb3A7XG4gICAgICBjb25zdCBhY3Rpb25TdHViID0gc2lub24uc3R1YihkLCAncGVyZm9ybVRvdWNoJyk7XG4gICAgICBjb25zdCBlbCA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgICAgLy8gc2tpcCB0aGUgc3RhbGVuZXNzIGNoZWNrIGZvciB0aGlzIHRlc3RcbiAgICAgIGF3YWl0IGQuc2V0dGluZ3MudXBkYXRlKHtcbiAgICAgICAgY2hlY2tGb3JJbWFnZUVsZW1lbnRTdGFsZW5lc3M6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgICBhd2FpdCBlbC5jbGljayhkKTtcbiAgICAgIGNvbnN0IGFjdGlvbiA9IGFjdGlvblN0dWIuYXJnc1swXVswXVswXS5vcHRpb25zO1xuICAgICAgYWN0aW9uLnguc2hvdWxkLmVxdWFsKGVsLmNlbnRlci54KTtcbiAgICAgIGFjdGlvbi55LnNob3VsZC5lcXVhbChlbC5jZW50ZXIueSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCB1c2UgdG91Y2hhY3Rpb25zIGlmIHJlcXVlc3RlZCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnN0IGQgPSBuZXcgQmFzZURyaXZlcigpO1xuICAgICAgZC5wZXJmb3JtQWN0aW9ucyA9IF8ubm9vcDtcbiAgICAgIGNvbnN0IHczY1N0dWIgPSBzaW5vbi5zdHViKGQsICdwZXJmb3JtQWN0aW9ucycpO1xuICAgICAgZC5wZXJmb3JtVG91Y2ggPSBfLm5vb3A7XG4gICAgICBjb25zdCB0b3VjaFN0dWIgPSBzaW5vbi5zdHViKGQsICdwZXJmb3JtVG91Y2gnKTtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICAvLyBza2lwIHRoZSBzdGFsZW5lc3MgY2hlY2sgZm9yIHRoaXMgdGVzdFxuICAgICAgYXdhaXQgZC5zZXR0aW5ncy51cGRhdGUoe1xuICAgICAgICBjaGVja0ZvckltYWdlRWxlbWVudFN0YWxlbmVzczogZmFsc2UsXG4gICAgICAgIGltYWdlRWxlbWVudFRhcFN0cmF0ZWd5OiAndG91Y2hBY3Rpb25zJyxcbiAgICAgIH0pO1xuICAgICAgYXdhaXQgZWwuY2xpY2soZCk7XG4gICAgICBjb25zdCBhY3Rpb24gPSB0b3VjaFN0dWIuYXJnc1swXVswXVswXS5vcHRpb25zO1xuICAgICAgYWN0aW9uLnguc2hvdWxkLmVxdWFsKGVsLmNlbnRlci54KTtcbiAgICAgIGFjdGlvbi55LnNob3VsZC5lcXVhbChlbC5jZW50ZXIueSk7XG4gICAgICB3M2NTdHViLmNhbGxDb3VudC5zaG91bGQuZXFsKDApO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgdGhyb3cgaWYgZHJpdmVyIGRvZXMgbm90IGltcGxlbWVudCBhbnkgdHlwZSBvZiBhY3Rpb24nLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBkID0gbmV3IEJhc2VEcml2ZXIoKTtcbiAgICAgIGNvbnN0IGVsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgICAvLyBza2lwIHRoZSBzdGFsZW5lc3MgY2hlY2sgZm9yIHRoaXMgdGVzdFxuICAgICAgYXdhaXQgZC5zZXR0aW5ncy51cGRhdGUoe1xuICAgICAgICBjaGVja0ZvckltYWdlRWxlbWVudFN0YWxlbmVzczogZmFsc2UsXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IGVsLmNsaWNrKGQpLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvZGlkIG5vdCBpbXBsZW1lbnQvKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJyNleGVjdXRlJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGltZ0VsID0gbmV3IEltYWdlRWxlbWVudChkZWZUZW1wbGF0ZSwgZGVmUmVjdCk7XG4gICAgY29uc3QgY2xpY2tTdHViID0gc2lub24uc3R1YihpbWdFbCwgJ2NsaWNrJyk7XG5cbiAgICBiZWZvcmUoZnVuY3Rpb24gKCkge1xuICAgICAgZHJpdmVyLl9pbWdFbENhY2hlLnNldChpbWdFbC5pZCwgaW1nRWwpO1xuICAgICAgY2xpY2tTdHViLnJldHVybnModHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBhZnRlcihmdW5jdGlvbiAoKSB7XG4gICAgICBkcml2ZXIuX2ltZ0VsQ2FjaGUucmVzZXQoKTtcbiAgICAgIGNsaWNrU3R1Yi5yZXN0b3JlKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlamVjdCBleGVjdXRpb25zIG9uIGVsZW1lbnRzIG5vdCBpbiB0aGUgY2FjaGUnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBJbWFnZUVsZW1lbnQuZXhlY3V0ZShkcml2ZXIsICdjbGljaycsICdhcHBpdW0taW1hZ2UtZWxlbWVudC1mb28nKVxuICAgICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWRXaXRoKC9lbGVtZW50IGNvdWxkIG5vdCBiZSBsb2NhdGVkLyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCByZWplY3QgZXhlY3V0aW9ucyBmb3IgdW5zdXBwb3J0ZWQgY29tbWFuZHMnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBJbWFnZUVsZW1lbnQuZXhlY3V0ZShkcml2ZXIsICdmb29iYXInLCBpbWdFbC5pZClcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvbm90IHlldCBiZWVuIGltcGxlbWVudGVkLyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgZGlzcGxheWVkIHN0YXR1cyBvZiBlbGVtZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgSW1hZ2VFbGVtZW50LmV4ZWN1dGUoZHJpdmVyLCAnZWxlbWVudERpc3BsYXllZCcsIGltZ0VsLmlkKVxuICAgICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuYmUudHJ1ZTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGdldCBzaXplIG9mIGVsZW1lbnQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBJbWFnZUVsZW1lbnQuZXhlY3V0ZShkcml2ZXIsICdnZXRTaXplJywgaW1nRWwuaWQpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5lcWwoe3dpZHRoOiBkZWZSZWN0LndpZHRoLCBoZWlnaHQ6IGRlZlJlY3QuaGVpZ2h0fSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgbG9jYXRpb24gb2YgZWxlbWVudCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IEltYWdlRWxlbWVudC5leGVjdXRlKGRyaXZlciwgJ2dldExvY2F0aW9uJywgaW1nRWwuaWQpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5lcWwoe3g6IGRlZlJlY3QueCwgeTogZGVmUmVjdC55fSk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBnZXQgbG9jYXRpb24gaW4gdmlldyBvZiBlbGVtZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgYXdhaXQgSW1hZ2VFbGVtZW50LmV4ZWN1dGUoZHJpdmVyLCAnZ2V0TG9jYXRpb24nLCBpbWdFbC5pZClcbiAgICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmVxbCh7eDogZGVmUmVjdC54LCB5OiBkZWZSZWN0Lnl9KTtcbiAgICB9KTtcbiAgICBpdCgnc2hvdWxkIGdldCByZWN0IG9mIGVsZW1lbnQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBhd2FpdCBJbWFnZUVsZW1lbnQuZXhlY3V0ZShkcml2ZXIsICdnZXRFbGVtZW50UmVjdCcsIGltZ0VsLmlkKVxuICAgICAgICAuc2hvdWxkLmV2ZW50dWFsbHkuZXFsKGRlZlJlY3QpO1xuICAgIH0pO1xuICAgIGl0KCdzaG91bGQgY2xpY2sgZWxlbWVudCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgIGF3YWl0IEltYWdlRWxlbWVudC5leGVjdXRlKGRyaXZlciwgJ2NsaWNrJywgaW1nRWwuaWQpXG4gICAgICAgIC5zaG91bGQuZXZlbnR1YWxseS5iZS50cnVlO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnaW1hZ2UgZWxlbWVudCBMUlUgY2FjaGUnLCBmdW5jdGlvbiAoKSB7XG4gIGl0KCdzaG91bGQgYWNjZXB0IGFuZCBjYWNoZSBpbWFnZSBlbGVtZW50cycsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBlbDEgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICBjb25zdCBlbDIgPSBuZXcgSW1hZ2VFbGVtZW50KGRlZlRlbXBsYXRlLCBkZWZSZWN0KTtcbiAgICBjb25zdCBjYWNoZSA9IG1ha2VJbWFnZUVsZW1lbnRDYWNoZSgpO1xuICAgIGNhY2hlLnNldChlbDEuaWQsIGVsMSk7XG4gICAgZWwxLmVxdWFscyhjYWNoZS5nZXQoZWwxLmlkKSkuc2hvdWxkLmJlLnRydWU7XG4gICAgXy5pc1VuZGVmaW5lZChjYWNoZS5nZXQoZWwyLmlkKSkuc2hvdWxkLmJlLnRydWU7XG4gICAgY2FjaGUuaGFzKGVsMS5pZCkuc2hvdWxkLmJlLnRydWU7XG4gICAgY2FjaGUuaGFzKGVsMi5pZCkuc2hvdWxkLmJlLmZhbHNlO1xuICB9KTtcbiAgaXQoJ29uY2UgY2FjaGUgcmVhY2hlcyBtYXggc2l6ZSwgc2hvdWxkIGVqZWN0IGltYWdlIGVsZW1lbnRzJywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IGVsMSA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgIGNvbnN0IGVsMiA9IG5ldyBJbWFnZUVsZW1lbnQoZGVmVGVtcGxhdGUsIGRlZlJlY3QpO1xuICAgIGNvbnN0IGNhY2hlID0gbWFrZUltYWdlRWxlbWVudENhY2hlKGRlZlRlbXBsYXRlLmxlbmd0aCArIDEpO1xuICAgIGNhY2hlLnNldChlbDEuaWQsIGVsMSk7XG4gICAgY2FjaGUuaGFzKGVsMS5pZCkuc2hvdWxkLmJlLnRydWU7XG4gICAgY2FjaGUuc2V0KGVsMi5pZCwgZWwyKTtcbiAgICBjYWNoZS5oYXMoZWwyLmlkKS5zaG91bGQuYmUudHJ1ZTtcbiAgICBjYWNoZS5oYXMoZWwxLmlkKS5zaG91bGQuYmUuZmFsc2U7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdnZXRJbWdFbEZyb21BcmdzJywgZnVuY3Rpb24gKCkge1xuICBpdCgnc2hvdWxkIHJldHVybiB0aGUgaW1hZ2UgZWxlbWVudCBpZCBmcm9tIGpzb24gb2JqIGluIGFyZ3MnLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgaW1nRWwgPSBgJHtJTUFHRV9FTEVNRU5UX1BSRUZJWH1mb29gO1xuICAgIGNvbnN0IGFyZ3MgPSBbMSwgJ2ZvbycsIGltZ0VsXTtcbiAgICBnZXRJbWdFbEZyb21BcmdzKGFyZ3MpLnNob3VsZC5lcWwoaW1nRWwpO1xuICB9KTtcbiAgaXQoJ3Nob3VsZCBub3QgcmV0dXJuIGFueXRoaW5nIGlmIGltYWdlIGVsZW1lbnQgaWQgbm90IGluIGFyZ3MnLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgYXJncyA9IFsxLCAnZm9vJ107XG4gICAgXy5pc1VuZGVmaW5lZChnZXRJbWdFbEZyb21BcmdzKGFyZ3MpKS5zaG91bGQuYmUudHJ1ZTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgbm90IGZpbmQgaW1hZ2UgZWxlbWVudCBpZCBpbiBhbnl0aGluZyBidXQgcHJlZml4JywgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IG5vdEltZ0VsID0gYGZvbyR7SU1BR0VfRUxFTUVOVF9QUkVGSVh9YDtcbiAgICBjb25zdCBhcmdzID0gWzEsICdmb28nLCBub3RJbWdFbF07XG4gICAgXy5pc1VuZGVmaW5lZChnZXRJbWdFbEZyb21BcmdzKGFyZ3MpKS5zaG91bGQuYmUudHJ1ZTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4ifQ==
